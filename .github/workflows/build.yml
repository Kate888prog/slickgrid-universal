name: Build Angular SlickGrid

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: Install pnpm
      run: npm install -g pnpm
      
    - name: Install root dependencies
      run: pnpm install
      
    # –°–Ω–∞—á–∞–ª–∞ —É–∑–Ω–∞–µ–º –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã
    - name: Check available scripts
      run: |
        echo "=== –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ angular-slickgrid ==="
        cd frameworks/angular-slickgrid
        pnpm run
      
    # –ü—Ä–æ–±—É–µ–º —Å–æ–±—Ä–∞—Ç—å —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
    - name: Try to build Angular
      run: |
        cd frameworks/angular-slickgrid
        
        # –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Angular –ø—Ä–æ–µ–∫—Ç–∞
        pnpm install
        
        # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏
        echo "–ü–æ–ø—ã—Ç–∫–∞ 1: pnpm run build"
        pnpm run build || echo "–ö–æ–º–∞–Ω–¥–∞ build –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞"
        
        echo "–ü–æ–ø—ã—Ç–∫–∞ 2: pnpm build"
        pnpm build || echo "–ö–æ–º–∞–Ω–¥–∞ pnpm build –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞"
        
        echo "–ü–æ–ø—ã—Ç–∫–∞ 3: npm run build"
        npm run build || echo "–ö–æ–º–∞–Ω–¥–∞ npm run build –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞"
        
        # –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–∑–¥–∞–ª–∞—Å—å –ª–∏ –ø–∞–ø–∫–∞ dist
        echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫—É dist:"
        ls -la | grep dist || echo "–ü–∞–ø–∫–∞ dist –Ω–µ —Å–æ–∑–¥–∞–Ω–∞"
        
    # –ï—Å–ª–∏ –ø–∞–ø–∫–∞ dist —Å–æ–∑–¥–∞–ª–∞—Å—å - —Å–æ–∑–¥–∞—ë–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
    - name: Create artifacts if build succeeded
      if: success()
      run: |
        cd frameworks/angular-slickgrid
        if [ -d "dist" ]; then
          echo "‚úÖ –ü–∞–ø–∫–∞ dist –Ω–∞–π–¥–µ–Ω–∞! –°–æ–∑–¥–∞—ë–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã..."
          cd dist
          zip -r angular-build.zip .
          echo "üì¶ –†–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞:"
          du -h angular-build.zip
        else
          echo "‚ùå –ü–∞–ø–∫–∞ dist –Ω–µ –Ω–∞–π–¥–µ–Ω–∞! –°–±–æ—Ä–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å."
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ angular-slickgrid:"
          ls -la
        fi
        
    - name: Upload artifacts
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: angular-build-result
        path: |
          frameworks/angular-slickgrid/dist/
          frameworks/angular-slickgrid/package.json
        retention-days: 30
        
    - name: Show final message
      run: |
        echo "=== –†–ï–ó–£–õ–¨–¢–ê–¢ ==="
        echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ"
        echo "–ï—Å–ª–∏ –µ—Å—Ç—å –ø–∞–ø–∫–∞ dist - –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã"