name: üì¶ Build Angular npm Package

on:
  workflow_dispatch:

jobs:
  build-package:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v4
      
    - name: ‚öôÔ∏è Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: üì¶ Install pnpm
      run: npm install -g pnpm
      
    - name: üìö Install dependencies
      run: pnpm install
      
    - name: üèóÔ∏è Build Angular npm package
      run: |
        cd frameworks/angular-slickgrid
        pnpm run build
        echo "‚úÖ NPM –ø–∞–∫–µ—Ç —Å–æ–∑–¥–∞–Ω!"
      
    - name: üîç Find npm package files
      run: |
        cd frameworks/angular-slickgrid
        echo "=== –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–∞–∫–µ—Ç–∞ ==="
        find . -name "*.tgz" -o -name "*.tar.gz" -o -name "package.json" | grep -v node_modules
        
        echo "=== –°–æ–¥–µ—Ä–∂–∏–º–æ–µ dist –ø–∞–ø–∫–∏ ==="
        ls -la dist/ || echo "–ù–µ—Ç dist –ø–∞–ø–∫–∏"
        
        echo "=== –°–æ–∑–¥–∞—ë–º npm –ø–∞–∫–µ—Ç –≤—Ä—É—á–Ω—É—é ==="
        npm pack ./dist/ 2>/dev/null || echo "–ü–æ–ø—ã—Ç–∫–∞ npm pack –Ω–µ —É–¥–∞–ª–∞—Å—å"
        
        echo "=== –§–∞–π–ª—ã –ø–æ—Å–ª–µ npm pack ==="
        ls -la *.tgz *.tar.gz 2>/dev/null || echo "–ù–µ—Ç tgz —Ñ–∞–π–ª–æ–≤"
      
    - name: üì¶ Create downloadable package
      run: |
        cd frameworks/angular-slickgrid
        
        # –°–æ–∑–¥–∞—ë–º –∞—Ä—Ö–∏–≤ —Å –í–°–ï–ú–ò —Ñ–∞–π–ª–∞–º–∏ –ø–∞–∫–µ—Ç–∞
        zip -r angular-npm-package.zip . -x "node_modules/*" ".*"
        
        # –¢–∞–∫–∂–µ –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∏ –¥–æ–±–∞–≤–∏—Ç—å .tgz —Ñ–∞–π–ª—ã
        find . -name "*.tgz" -o -name "*.tar.gz" | head -5 | while read file; do
          echo "–ù–∞–π–¥–µ–Ω –ø–∞–∫–µ—Ç: $file"
          cp "$file" ./
        done
        
        echo "üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
        ls -la *.zip *.tgz *.tar.gz 2>/dev/null || echo "–ù–µ—Ç –∞—Ä—Ö–∏–≤–æ–≤"
      
    - name: ‚¨ÜÔ∏è Upload npm package
      uses: actions/upload-artifact@v4
      with:
        name: angular-slickgrid-npm-package
        path: |
          frameworks/angular-slickgrid/angular-npm-package.zip
          frameworks/angular-slickgrid/*.tgz
          frameworks/angular-slickgrid/*.tar.gz
        retention-days: 30
        
    - name: üìã Package info
      run: |
        cd frameworks/angular-slickgrid
        echo "üéâ NPM –ü–ê–ö–ï–¢ –°–û–ó–î–ê–ù!"
        echo ""
        echo "üì¶ –ß—Ç–æ –≤ –∞—Ä—Ö–∏–≤–µ:"
        echo "  - angular-npm-package.zip - –ü–û–õ–ù–´–ô –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥"
        echo "  - *.tgz - –ì–æ—Ç–æ–≤—ã–π npm –ø–∞–∫–µ—Ç (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–ª—Å—è)"
        echo ""
        echo "üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö:"
        echo "  1. –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ö–∏–≤"
        echo "  2. –ï—Å–ª–∏ –µ—Å—Ç—å .tgz —Ñ–∞–π–ª: npm install ./angular-slickgrid-*.tgz"
        echo "  3. –ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ src/ –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç"
        echo ""
        echo "üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–∞:"
        echo "  dist/ - –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏"
        echo "  src/  - –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤"
        echo "  *.json - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã"
