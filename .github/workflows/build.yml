name: Build Angular SlickGrid

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: Install pnpm
      run: npm install -g pnpm
      
    - name: Install root dependencies
      run: pnpm install
      
    - name: Build Angular and find dist
      run: |
        echo "=== –¢–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞ ==="
        pwd
        
        echo "=== –°–æ–±–∏—Ä–∞–µ–º Angular ==="
        cd frameworks/angular-slickgrid
        pnpm install
        pnpm run build
        
        echo "=== –ò—â–µ–º –ø–∞–ø–∫—É dist ==="
        find . -name "dist" -type d
        echo "=== –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–∏ ==="
        ls -la
        echo "=== –ï—Å–ª–∏ –µ—Å—Ç—å dist - –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ ==="
        if [ -d "dist" ]; then
          ls -la dist/
        else
          echo "‚ùå –ü–∞–ø–∫–∞ dist –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ angular-slickgrid!"
          echo "=== –ò—â–µ–º –≤–æ –≤—Å—ë–º –ø—Ä–æ–µ–∫—Ç–µ ==="
          cd ../..
          find . -name "dist" -type d
        fi
        
    - name: Create artifacts from correct location
      run: |
        echo "=== –°–æ–∑–¥–∞—ë–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã ==="
        
        # –ü—Ä–æ–≤–µ—Ä–∏–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è dist
        if [ -d "frameworks/angular-slickgrid/dist" ]; then
          echo "‚úÖ –ù–∞—à–ª–∏ dist –≤ frameworks/angular-slickgrid/dist"
          cd frameworks/angular-slickgrid/dist
          ls -la
          zip -r angular-build.zip .
          echo "üì¶ ZIP —Å–æ–∑–¥–∞–Ω"
        elif [ -d "dist" ]; then
          echo "‚úÖ –ù–∞—à–ª–∏ dist –≤ –∫–æ—Ä–Ω–µ"
          cd dist
          ls -la
          zip -r angular-build.zip .
          echo "üì¶ ZIP —Å–æ–∑–¥–∞–Ω"
        else
          echo "‚ùå –ü–∞–ø–∫–∞ dist –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
          # –°–æ–∑–¥–∞–¥–∏–º –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª —á—Ç–æ–±—ã workflow –Ω–µ —É–ø–∞–ª
          echo "empty" > dummy.txt
          zip angular-build.zip dummy.txt
        fi
        
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: angular-slickgrid-build
        path: |
          angular-build.zip
          frameworks/angular-slickgrid/dist/
        retention-days: 30
        
    - name: Final check
      run: |
        echo "=== –†–ï–ó–£–õ–¨–¢–ê–¢ ==="
        if [ -f "angular-build.zip" ]; then
          echo "‚úÖ ZIP –∞—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω:"
          du -h angular-build.zip
        else
          echo "‚ùå ZIP –∞—Ä—Ö–∏–≤ –Ω–µ —Å–æ–∑–¥–∞–Ω"
        fi
        
        if [ -d "frameworks/angular-slickgrid/dist" ]; then
          echo "‚úÖ –ü–∞–ø–∫–∞ dist –Ω–∞–π–¥–µ–Ω–∞"
          echo "üìÅ –†–∞–∑–º–µ—Ä:"
          du -sh frameworks/angular-slickgrid/dist/
        else
          echo "‚ùå –ü–∞–ø–∫–∞ dist –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
        fi